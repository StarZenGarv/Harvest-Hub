{% extends 'base.html' %}
{% block content %}
<div class="container mt-4">
    <h1 class="text-center mb-4 text-white bg-success p-2 rounded">
        ðŸŒ¾ Marketplace - {{ role|capitalize }}
    </h1>

    <div class="row">
        {% for item in items %}
        <div class="col-md-4 mb-4">
            <div class="card shadow-lg border-0"
                 style="
                    height: 320px;
                    background-image: url('{{ url_for('static', filename='uploads/' ~ item.image) }}');
                    background-size: cover;
                    background-position: center;
                    border-radius: 15px;
                    position: relative;
                 ">
                <div style="
                    background: rgba(255, 255, 255, 0.6);
                    position: absolute;
                    inset: 0;
                    border-radius: 15px;
                    padding: 15px;
                    display: flex;
                    flex-direction: column;
                    justify-content: space-between;
                    color: white;
                ">
                    <div>
                        <h3 class="card-title fw-bold text-black">{{ item.name }}</h3>
                        <p class="card-text text-black mb-1"><strong>Description:</strong> {{ item.description }}</p>
                        <p class="card-text text-black mb-1"><strong>Quantity:</strong> {{ item.quantity }}</p>
                        <p class="card-text text-black mb-1"><strong>Price (â‚¹):</strong> {{ item.price }}</p>
                        <p class="card-text text-black mb-1"><strong>Owner:</strong> {{ item.owner }}</p>
                        <p class="card-text text-black mb-1"><strong>Location:</strong> {{ item.location }}</p>
                    </div>

                    {% if session['role'] in ['ngo', 'buyer'] %}
                    <div>
                        <form action="{{ url_for('buy_item', item_id=item.id) }}" method="POST" style="display:inline;">
                            <button type="submit" class="btn btn-warning btn-sm"
                                    onclick="return confirm('Are you sure you want to order this item?');">
                                ðŸ›’ Buy
                            </button>
                        </form>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}

        {% if items|length == 0 %}
        <p class="text-center text-muted">No items available in the marketplace.</p>
        {% endif %}
    </div>
</div>

<!-- âœ… JS Alert for Purchase -->
{% if request.args.get('ordered') %}
<script>
    alert("âœ… Item successfully ordered! You can pick it up from {{ request.args.get('ordered') }}.");
</script>
{% endif %}

{% endblock %}
